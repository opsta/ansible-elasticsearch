---
- include_tasks: elasticsearch_pre.yml
- include_tasks: elasticsearch_install.yml

- block: # Config Elasticsearch
  - include_tasks: elasticsearch_search_config.yml
  - include_tasks: elasticsearch_post.yml
  - include_tasks: elasticsearch_user.yml
    when: inventory_hostname in groups['elasticsearch-master'] | default([]) or groups['elasticsearch'] | default([]) | length == 1
  - include_tasks: elasticsearch_activate.yml
    when:
      - inventory_hostname in groups['elasticsearch-master'] | default([]) or groups['elasticsearch'] | default([]) | length == 1
      - elasticsearch_license_check.stat.exists
      - elasticsearch_major_version == 5
  tags:
    - elasticsearch-config